I"(¤<blockquote>
  <p><a href="https://refantasy.cn/2020/03/04/éšæœºäº‹ä»¶ä¸æ¦‚ç‡.html">è´å¶æ–¯å…¬å¼å‚è§</a></p>

  <p>æœ¬æ–‡å†…å®¹å’Œå…¬å¼ä¸»è¦å‚è€ƒ æèˆªã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹</p>
</blockquote>

<h2 id="åŸºæœ¬æ€æƒ³">åŸºæœ¬æ€æƒ³</h2>

<p>è®¾$X$ä¸ºéšæœºå‘é‡ï¼Œå³æ•°æ®çš„ç‰¹å¾å‘é‡ï¼Œ$Y$ä¸ºè¾“å‡ºç©ºé—´çš„éšæœºå˜é‡ï¼Œå³åˆ†ç±»ç»“æœã€‚$P(X,Y)$æ˜¯$X$å’Œ$Y$çš„è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œå¹¶é€šè¿‡æ­¤æ¦‚ç‡åˆ†å¸ƒç”Ÿæˆè®­ç»ƒæ•°æ®é›†ã€‚</p>

<script type="math/tex; mode=display">T=\{(x_1,y_1),(x_2,y_2),...,(x_N,y_N)\}</script>

<p>å…¶ä¸­ï¼Œå…ˆéªŒæ¦‚ç‡åˆ†å¸ƒä¸º</p>

<script type="math/tex; mode=display">\begin{equation}
P(Y=c_k),\quad k=1,2,...,K
\end{equation}</script>

<p>æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒä¸º</p>

<script type="math/tex; mode=display">P(X=x|Y=c_k)=P(X^{(1)}=x^{(1)},X^{(2)}=x^{(2)},...,X^{(n)}=x^{(n)}|Y=c_k),k=1,2,...,K</script>

<p>ç”±è´å¶æ–¯å…¬å¼å¯çŸ¥</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\begin{aligned}
P(Y=c_k|X = x)&=\frac{P((X=x)Â·(Y=c_k))}{P(X=x)}\\
              &=\frac{P(X=x|Y=c_k)P(Y=c_k)}{\sum_kP(X=x|Y=c_k)P(Y=c_k)}
\end{aligned}
\end{equation} %]]></script>

<p>å…¶ä¸­ï¼Œ$K$ä¸ºæ ·æœ¬ç±»åˆ«æ•°ç›®ã€‚åœ¨å¼$(4)$ä¸­ï¼Œ$x$è¡¨ç¤ºä»»æ„æ ·æœ¬å®ä¾‹ï¼Œ$c_k$è¡¨ç¤ºéšæœºå˜é‡$Y$å–åˆ°çš„å€¼ã€‚$P(Y=c_k|X = x)$è¡¨ç¤ºè¾“å…¥æ ·æœ¬$x$ï¼Œè¾“å‡ºåˆ†ç±»æ ‡ç­¾$Y=c_k$çš„æ¦‚ç‡ã€‚åœ¨è¿›è¡Œåˆ†ç±»æ—¶ï¼Œå–$y=f(x)=\mathop{\arg\max}_{c_k} P(Y=c_k|X=x)$å³ä¸ºæˆ‘ä»¬æ‰€è¦é¢„æµ‹çš„åˆ†ç±»ç»“æœã€‚</p>

<p>æ³¨æ„åˆ°ï¼Œåœ¨å¼$(4)$ä¸­ï¼Œå¯¹äº$\forall c_k$ï¼Œåˆ†æ¯çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥</p>

<script type="math/tex; mode=display">y=\mathop{\arg\max}_{c_k}P(X=x|Y=c_k)P(Y=c_k)</script>

<p>$y$ å³ä¸ºæ‰€è¦é¢„æµ‹çš„$x$çš„åˆ†ç±»ç»“æœã€‚</p>

<h2 id="å‚æ•°ä¼°è®¡">å‚æ•°ä¼°è®¡</h2>

<p>åœ¨æœ´ç´ è´å¶æ–¯æ³•ä¸­ï¼Œå­¦ä¹ æ„å‘³ç€ä¼°è®¡$P({Y=c_k})$å’Œ$P({X = x}|{Y=c_k})$ã€‚å…ˆéªŒæ¦‚ç‡$P(Y=c_k)$çš„æå¤§ä¼¼ç„¶ä¼°è®¡ä¸º</p>

<script type="math/tex; mode=display">P(Y=c_k)=\frac{\sum_{i=1}^NI(y_i=c_k)}{N},k=1,2,...,K</script>

<p>å…¶ä¸­ï¼Œ$N$ä¸ºæ ·æœ¬ä¸ªæ•°ï¼Œ$I$ä¸ºæŒ‡ç¤ºå‡½æ•°ã€‚</p>

<p>æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ$P(X=x|Y=c_k)$æœ‰æŒ‡æ•°çº§å‚æ•°ï¼Œå…¶ä¼°è®¡å®é™…æ˜¯ä¸å¯è¡Œçš„ã€‚äº‹å®ä¸Šï¼Œå‡è®¾$x^{(j)}$ä¸ºéšæœºå˜é‡$X$ç¬¬$j$ç»´çš„å€¼ï¼Œè®¾å…¶å¯å–å€¼æœ‰$S_j$ä¸ªï¼Œ$j=1,2,â€¦,n$ï¼Œ$Y$çš„å¯å–å€¼æœ‰$K$ä¸ªï¼Œé‚£ä¹ˆæ¡ä»¶æ¦‚ç‡åˆ†å¸ƒçš„å‚æ•°ä¸ªæ•°ä¸º$K\prod_{j=1}^nS_j$ã€‚æœ´ç´ è´å¶æ–¯æ³•å¯¹æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒåšäº†æ¡ä»¶ç‹¬ç«‹çš„å‡è®¾ï¼Œè¿™ä¹Ÿæ˜¯â€œæœ´ç´ â€çš„å¾—åç”±æ¥ã€‚å…·ä½“åœ°ï¼Œæ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾æ˜¯</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{equation}
\begin{aligned}
P(X=x|Y=c_k)&=P(X^{(1)}=x^{(1)},...,X^{(n)}=x^{(n)}|Y=c_k)\\
            &=\prod_{j=1}^nP(X^{(j)}=x^{(j)}|Y=c_k)
\end{aligned}
\end{equation} %]]></script>

<p>å…¶ä¸­ï¼Œ</p>

<script type="math/tex; mode=display">P(X^{(j)}=a_{jl}|Y=c_k)=\frac{\sum_{i=1}^NI(x_i^{(j)}=a_{jl},y_i=c_k)}{\sum_{i=1}^NI(y_i=c_k)}</script>

<p>$l=1,2,â€¦,S_j$ï¼Œ$a_{jl}$æ˜¯ç¬¬$j$ä¸ªç‰¹å¾å¯èƒ½å–å¾—ç¬¬$l$ä¸ªå€¼ã€‚</p>

<p>ç”±å¼$(5)(6)(7)(8)$å³å¯æ±‚å‡ºéšæœºå˜é‡$X=x$æ—¶çš„åˆ†ç±»ç»“æœã€‚</p>

<h2 id="å­¦ä¹ ä¸åˆ†ç±»ç®—æ³•">å­¦ä¹ ä¸åˆ†ç±»ç®—æ³•</h2>

<hr />

<p><strong>ç®—æ³• æœ´ç´ è´å¶æ–¯ç®—æ³•</strong></p>

<hr />

<p>è¾“å…¥ï¼šè®­ç»ƒæ•°æ®$T$ï¼Œå¾…é¢„æµ‹å®ä¾‹$x$</p>

<p>è¾“å‡ºï¼šå®ä¾‹$x$çš„åˆ†ç±»</p>

<ol>
  <li>
    <p>è®¡ç®—å…ˆéªŒæ¦‚ç‡ä»¥åŠæ¡ä»¶æ¦‚ç‡</p>

    <script type="math/tex; mode=display">P(Y=c_k)ï¼ŒP(X^{(j)}=a_{jl}\|Y=c_k)</script>
  </li>
  <li>
    <p>å¯¹äºç»™å®šå®ä¾‹$x=(x^{(1)},x^{(2)},â€¦,x^{(n)})^T$ï¼Œè®¡ç®—</p>

    <script type="math/tex; mode=display">P(Y=c_k)\prod_{j=1}^nP(X^{(j)}=x^{(j)}\|Y=c_k),k=1,2,...,K</script>
  </li>
  <li>
    <p>ç¡®å®šå®ä¾‹$x$çš„åˆ†ç±»</p>

    <script type="math/tex; mode=display">y=\mathop{\arg\max}_{c_k}P(Y=c_k)\prod_{j=1}^nP(X^{(j)}=x^{(j)}\|Y=c_k)</script>
  </li>
</ol>

<hr />

<h2 id="è´å¶æ–¯ä¼°è®¡">è´å¶æ–¯ä¼°è®¡</h2>

<p>æå¤§ä¼¼ç„¶æ³•ä¼°è®¡å¯èƒ½ä¼šå‡ºç°æ‰€è¦ä¼°è®¡çš„æ¦‚ç‡ä¸º0çš„æƒ…å†µã€‚è¿™ä¼šå½±å“åˆ°åéªŒæ¦‚ç‡çš„è®¡ç®—ç»“æœï¼Œä½¿åˆ†ç±»äº§ç”Ÿåå·®ã€‚è§£å†³è¿™ä¸€é—®é¢˜æ˜¯ä½¿ç”¨è´å¶æ–¯ä¼°è®¡ã€‚å…·ä½“åœ°ï¼Œæ¡ä»¶æ¦‚ç‡çš„è´å¶æ–¯ä¼°è®¡æ˜¯</p>

<script type="math/tex; mode=display">P(X^{(j)}=a_{jl}|Y=c_k)=\frac{\sum_{i=1}^NI(x_i^{(j)}=a_{jl},y_i=c_k)+\lambda}{\sum_{i=1}^NI(y_i=c_k)+S_j\lambda},\quad\lambda\geq 0</script>

<p>åŒæ ·åœ°ï¼Œå…ˆéªŒæ¦‚ç‡çš„è´å¶æ–¯ä¼°è®¡æ˜¯</p>

<script type="math/tex; mode=display">P(Y=c_k)=\frac{\sum_{i=1}^NI(y_i=c_k)+\lambda}{N+K\lambda}</script>

<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>

<p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªé€šç”¨æ•°æ®é›†ç±»</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 *
 * 
 *    é€šç”¨æ•°æ®é›†ç±»
 * 
 *    æ¨¡æ¿å‚æ•° D ä¸ºæ ·æœ¬æ•°æ®éƒ¨åˆ†çš„æ•°æ®ç±»å‹
 *    æ¨¡æ¿å‚æ•° L ä¸ºæ ·æœ¬æ ‡ç­¾éƒ¨åˆ†çš„æ•°æ®ç±»å‹
 *    ä¸€ä¸ªæ ·å¸ƒæ•°æ®å’Œä¸€ä¸ªæ ·æœ¬æ ‡ç­¾ç»„æˆä¸€æ¡è®°å½•
 *    é»˜è®¤ä½¿ç”¨ vector å®¹å™¨ä¿å­˜æ•°æ®è®°å½•
 * 
 *    License: MIT
 * 
 *    Â©TDL 2020.03.13
 *    Contact:refantasy.cn
 * 
 */</span>
<span class="cp">#include &lt;utility&gt;
#include &lt;vector&gt;
</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">D</span><span class="p">,</span> <span class="k">typename</span> <span class="n">L</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">DataSet</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">D</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">label_type</span> <span class="o">=</span> <span class="n">L</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">record_type</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span> <span class="n">L</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="n">DataSet</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="cm">/* *\brief æ’å…¥ä¸€ä¸ªæ ·æœ¬
     *  \param d æ ·æœ¬ç‰¹å¾å‘é‡
     *  \param la æ ·æœ¬æ ‡ç­¾å€¼
     */</span>
    <span class="kt">void</span> <span class="n">Insert</span><span class="p">(</span><span class="k">const</span> <span class="n">value_type</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">,</span> <span class="k">const</span> <span class="n">label_type</span> <span class="o">&amp;</span><span class="n">la</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">data</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">d</span><span class="p">,</span> <span class="n">la</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="cm">/* *\brief æŸ¥æ‰¾ä¸€ä¸ªæ ·æœ¬
     *  \param n æ ·æœ¬ç´¢å¼•
     *  \return ä¸€æ¡è®°å½•å¼•ç”¨
     */</span>
    <span class="k">const</span> <span class="n">record_type</span><span class="o">&amp;</span> <span class="n">GetRecord</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// æ•°æ®é›†å¤§å°</span>
    <span class="kt">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="p">}</span>

<span class="nl">private:</span>
    <span class="c1">// æ ·æœ¬é›†åˆ</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">record_type</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

</code></pre></div></div>

<p>è´å¶æ–¯åˆ†ç±»å™¨</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 *
 *    æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ æèˆªã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä»£ç å®ç°
 *
 *    è¯¥ç±»ä»…ç”¨äºç ”ç©¶è´å¶æ–¯åˆ†ç±»ç®—æ³•ï¼Œæ ·æœ¬ç‰¹å¾çš„ä¸åŒç‰¹å¾é»˜è®¤é‡‡ç”¨åŒç§æ•°æ®ç±»å‹ï¼ˆæ•´å‹ï¼‰è¡¨ç¤º
 *    æ ·æœ¬ç±»åˆ«æ ‡ç­¾å¿…é¡»æ˜¯ä»é›¶å¼€å§‹çš„è¿ç»­æ•´æ•°
 *
 *    License: MIT
 * 
 *    Â©TDL 2020.03.13
 *    Contact:refantasy.cn
 * 
 */</span>
<span class="cp">#include &lt;vector&gt;
#include &lt;array&gt;
#include "dataset.hpp"
</span>
<span class="cm">/*
 * *\brief è´å¶æ–¯åˆ†ç±»å™¨
 *  \param dims æ ·æœ¬ç‰¹å¾çš„ç»´åº¦
 *  \param ClassesN åˆ†ç±»çš„ç±»åˆ«:0,1,2,...,ClassesN-1
 *  \param MaxFeaValue ç‰¹å¾å€¼å¾—æœ€å¤§å–å€¼
 */</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">dims</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ClassesN</span><span class="p">,</span> <span class="kt">int</span> <span class="n">MaxFeaValue</span><span class="p">,</span> <span class="k">typename</span> <span class="n">FEATURE_TYPE</span> <span class="o">=</span> <span class="kt">int</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Bayes</span>
<span class="p">{</span>
    <span class="k">friend</span> <span class="kt">void</span> <span class="n">Example_4_2</span><span class="p">();</span>

<span class="nl">public:</span>
    <span class="n">Bayes</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="cm">/* *\param d æ•°æ®é›†ï¼Œç”±è‹¥å¹²æ¡è®°å½•ç»„æˆï¼Œæ¯æ¡è®°å½•ç”±ç‰¹å¾å‘é‡å’Œæ ‡ç­¾ç»„æˆ
     *  \param lambd è´å¶æ–¯ä¼°è®¡å‚æ•°ï¼Œé»˜è®¤ä¸º0ï¼Œé€šå¸¸å–1
     *  \param Sj Sj[i]è¡¨ç¤ºç¬¬iç»´ç‰¹å¾å¯èƒ½å–åˆ°çš„å€¼å¾—ä¸ªæ•°
     */</span>
    <span class="n">Bayes</span><span class="p">(</span><span class="k">const</span> <span class="n">DataSet</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">FEATURE_TYPE</span><span class="p">,</span> <span class="n">dims</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">,</span>
          <span class="kt">double</span> <span class="n">lambda</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">Sj</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">MaxFeaValue</span><span class="p">))</span> <span class="o">:</span> <span class="n">_dataset</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">_lambda</span><span class="p">(</span><span class="n">lambda</span><span class="p">),</span> <span class="n">_Sj</span><span class="p">(</span><span class="n">Sj</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">MaxK</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">GetRecord</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">second</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">GetRecord</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">second</span> <span class="o">&gt;</span> <span class="n">MaxK</span><span class="p">)</span>
                <span class="n">MaxK</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">GetRecord</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">second</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">MaxK</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// è®­ç»ƒ</span>
    <span class="kt">void</span> <span class="n">Train</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">ComputePrior</span><span class="p">();</span>
        <span class="n">ComputeConditionPrior</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// é¢„æµ‹</span>
    <span class="kt">int</span> <span class="n">Pred</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">FEATURE_TYPE</span><span class="p">,</span> <span class="n">dims</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">result</span><span class="p">[</span><span class="n">ClassesN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">ClassesN</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">double</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">_prior_probability</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">prob</span> <span class="o">*=</span> <span class="n">_condition_probability</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
            <span class="p">}</span>

            <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">;</span>
            <span class="c1">//std::cout&lt;&lt;prob&lt;&lt;std::endl;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">max_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">ClassesN</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">result</span><span class="p">[</span><span class="n">max_index</span><span class="p">])</span>
                <span class="n">max_index</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">max_index</span><span class="p">;</span>
    <span class="p">}</span>

<span class="nl">private:</span>
    <span class="c1">// è®¡ç®—å…ˆéªŒæ¦‚ç‡</span>
    <span class="kt">void</span> <span class="n">ComputePrior</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">ClassesN</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_dataset</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_dataset</span><span class="p">.</span><span class="n">GetRecord</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">second</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
                    <span class="n">I</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">_prior_probability</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">I</span> <span class="o">+</span> <span class="n">_lambda</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">_dataset</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">_lambda</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// è®¡ç®—æ¡ä»¶æ¦‚ç‡</span>
    <span class="kt">void</span> <span class="n">ComputeConditionPrior</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">ClassesN</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="n">MaxFeaValue</span><span class="p">;</span> <span class="n">L</span><span class="o">++</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">int</span> <span class="n">p_x_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="kt">int</span> <span class="n">y_c_k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_dataset</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">_dataset</span><span class="p">.</span><span class="n">GetRecord</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">second</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">y_c_k</span><span class="o">++</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">_dataset</span><span class="p">.</span><span class="n">GetRecord</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">first</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">L</span><span class="p">)</span>
                                <span class="n">p_x_y</span><span class="o">++</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="n">_condition_probability</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">L</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">p_x_y</span> <span class="o">+</span> <span class="n">_lambda</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_c_k</span> <span class="o">+</span> <span class="n">_Sj</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">_lambda</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="nl">private:</span>
    <span class="c1">// æ•°æ®é›†</span>
    <span class="n">DataSet</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">FEATURE_TYPE</span><span class="p">,</span> <span class="n">dims</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">_dataset</span><span class="p">;</span>

    <span class="c1">// å…ˆéªŒæ¦‚ç‡</span>
    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">ClassesN</span><span class="o">&gt;</span> <span class="n">_prior_probability</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

    <span class="c1">// æ¡ä»¶æ¦‚ç‡</span>
    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">MaxFeaValue</span> <span class="o">+</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">dims</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ClassesN</span><span class="o">&gt;</span> <span class="n">_condition_probability</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

    <span class="kt">double</span> <span class="n">_lambda</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// ç‰¹å¾å€¼å¯å–å€¼å¾—ä¸ªæ•°</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">_Sj</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">MaxFeaValue</span><span class="p">);</span>

    <span class="c1">// æ ·æœ¬æ ‡ç­¾å¯å–åˆ°çš„å€¼çš„ä¸ªæ•°</span>
    <span class="kt">int</span> <span class="n">K</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¾‹4-2</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">Example_4_2</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">S</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="c1">// åˆ›å»ºæ•°æ®é›†</span>
    <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">dims</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">MaxFeaValue</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">classes</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// æ ‡ç­¾é‡æ–°æ˜ å°„åˆ°è¿ç»­æ•´å½¢ y = -1 -&gt; 0,  y = 1 -&gt; 1</span>
    <span class="n">DataSet</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">dims</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>

    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="n">S</span><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="n">S</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="n">S</span><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="n">S</span><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="n">M</span><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="n">M</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="n">M</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="n">M</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">Insert</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// åˆ›å»ºåˆ†ç±»å™¨å¹¶ä¼ å…¥æ•°æ®é›†</span>
    <span class="n">Bayes</span><span class="o">&lt;</span><span class="n">dims</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">MaxFeaValue</span><span class="o">&gt;</span> <span class="n">bayes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// è®­ç»ƒ</span>
    <span class="n">bayes</span><span class="p">.</span><span class="n">Train</span><span class="p">();</span>

    <span class="c1">// è¾“å‡ºå…ˆéªŒæ¦‚ç‡</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"å…ˆéªŒæ¦‚ç‡"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">auto</span> <span class="o">&amp;</span><span class="n">prior</span> <span class="o">=</span> <span class="n">bayes</span><span class="p">.</span><span class="n">_prior_probability</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">prior</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"P(Y="</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">")="</span> <span class="o">&lt;&lt;</span> <span class="n">prior</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// è¾“å‡ºæ¡ä»¶æ¦‚ç‡</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"æ¡ä»¶æ¦‚ç‡(SMLåˆ†åˆ«ç”¨123æ›¿æ¢)"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">auto</span> <span class="o">&amp;</span><span class="n">condi</span> <span class="o">=</span> <span class="n">bayes</span><span class="p">.</span><span class="n">_condition_probability</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">f</span> <span class="o">=</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="s">"S"</span><span class="p">;</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="k">return</span> <span class="s">"M"</span><span class="p">;</span><span class="k">else</span> <span class="k">return</span> <span class="s">"L"</span><span class="p">;</span> <span class="p">};</span>
    <span class="k">auto</span> <span class="n">g</span> <span class="o">=</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="k">else</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">prior</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="n">MaxFeaValue</span><span class="p">;</span> <span class="n">L</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"P(X"</span>
                              <span class="o">&lt;&lt;</span> <span class="s">"^"</span> <span class="o">&lt;&lt;</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">"="</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"|Y="</span> <span class="o">&lt;&lt;</span> <span class="n">g</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">") = "</span> <span class="o">&lt;&lt;</span> <span class="n">condi</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">L</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"P(X"</span>
                              <span class="o">&lt;&lt;</span> <span class="s">"^"</span> <span class="o">&lt;&lt;</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">"="</span> <span class="o">&lt;&lt;</span> <span class="n">L</span> <span class="o">&lt;&lt;</span> <span class="s">"|Y="</span> <span class="o">&lt;&lt;</span> <span class="n">g</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">") = "</span> <span class="o">&lt;&lt;</span> <span class="n">condi</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">L</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// é¢„æµ‹</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"é¢„æµ‹"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="n">S</span><span class="p">};</span>
    <span class="kt">int</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">bayes</span><span class="p">.</span><span class="n">Pred</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"P(x=(2,S)) = "</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">g</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

:ET